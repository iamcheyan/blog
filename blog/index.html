<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=endge, chrome=IE8" />
    <meta name="viewport" content="initial-scale=1.0, width=device-width, user-scalable=no" />
    <title>iamcheyan.com</title>
    <!--[if lte IE 8]>
        <script type="text/javascript" src="./theme/js/html5shiv.js"></script><![endif]-->
    <script type="text/javascript" src="./theme/js/jquery-3.6.4.min.js"></script>
    <script type="text/javascript" src="./theme/js/script.js" charset="utf-8"></script>
    <link rel="stylesheet" type="text/css" href="./theme/che.css" />
    <link rel="stylesheet" type="text/css" href="./theme/css/theme.css" />
    <script src="./theme/js/random_articles.js"></script>
    <link rel="shortcut icon" type="image/x-icon" href="./theme/favicon.ico" />
    <!--[if lte IE 8]>
        <link rel="shortcut icon" type="image/x-icon" href="./theme/favicon.ico"/>
        <![endif]-->
    <link rel="alternate" type="application/atom+xml" title="iamcheyan.com — Flux Atom"
        href="./" />
</head>

<body>
    <div id="page">
        <header id="page-head">
            <div id="topbar">
                <a href="?lang=ja" class="on">日本語</a>
                <a href="?lang=zh-cn">中文</a>
            </div>
            <nav class="navbar" role="navigation">
                <h1><a href="http://iamcheyan.com/">Iam cheyan .com</a></h1>
                <ul class="a">
                    <li class="i">
                        <a href="app/pelican/blog/">ブログ</a>
                    </li>
                    <li class="i">
                        <a class="icon"
                            href="https://github.com/iamcheyan/" target="_blank" aria-label="GitHub">
                            <svg width="32" height="32" viewBox="0 0 1024 1024" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M512 76C273.6 76 76 273.6 76 512c0 192.8 125.2 356.4 298.8 414.2 21.8 4 29.8-9.4 29.8-20.8 0-10.2-0.4-44-0.6-79.8-121.6 26.4-147.4-51.6-147.4-51.6-19.8-50.2-48.4-63.6-48.4-63.6-39.6-27 3-26.4 3-26.4 43.8 3.2 66.8 45 66.8 45 38.8 66.6 101.8 47.4 126.6 36.2 3.8-28 15.2-47.4 27.6-58.4-97-11-199-48.4-199-215.6 0-47.6 17-86.6 44.8-117.2-4.6-11-19.4-55.2 4.2-115 0 0 36.6-11.8 120 44.8 34.8-9.6 72-14.4 109.2-14.6 37.2 0.2 74.4 5 109.2 14.6 83.2-56.6 119.8-44.8 119.8-44.8 23.6 59.8 8.8 104 4.2 115 27.8 30.6 44.8 69.6 44.8 117.2 0 167.6-102.2 204.4-199.6 215.2 15.6 13.4 29.4 39.8 29.4 80.2 0 57.8-0.6 104.4-0.6 118.6 0 11.6 7.8 25.2 30 20.8C822.8 868.2 948 704.8 948 512 948 273.6 750.4 76 512 76z"/>
                            </svg>
                        </a>
                    </li>
                    <li class="i">
                        <a class="icon"
                            href="https://x.com/iamcheyan/" target="_blank" aria-label="Twitter">
                            <svg width="32" height="32" viewBox="0 0 1024 1024" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1024 194.6c-37.7 16.7-78.2 28-120.7 33.1 43.4-26 76.7-67.2 92.4-116.3-40.6 24.1-85.6 41.6-133.6 51-38.3-40.8-92.9-66.3-153.3-66.3-116 0-210 94-210 210 0 16.5 1.9 32.6 5.5 48-174.5-8.8-329.1-92.4-432.5-219.5-18.1 31-28.5 67-28.5 105.5 0 72.8 37.1 137.1 93.6 174.7-34.4-1.1-66.8-10.5-95.2-26.2v2.6c0 101.8 72.4 186.7 168.5 206-17.6 4.8-36.1 7.4-55.2 7.4-13.5 0-26.6-1.3-39.4-3.7 26.7 83.3 104.1 143.9 195.8 145.5-71.8 56.3-162.3 89.9-260.6 89.9-16.9 0-33.6-1-50-2.9 92.9 59.6 203.3 94.4 322 94.4 386.4 0 597.9-320.2 597.9-597.9 0-9.1-0.2-18.2-0.6-27.2 41-29.6 76.6-66.5 104.7-108.6z"/>
                            </svg>
                        </a>
                    </li>
                </ul>
            </nav>
        </header>

        <div id="page-body">
            <section id="page-main" role="main">
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        var templates = document.querySelectorAll('script[type="application/x-template"][id^="post-source-"]');
        for (var i = 0; i < templates.length; i++) {
            var tpl = templates[i];
            var idx = tpl.id.replace('post-source-', '');
            var target = document.getElementById('post-content-' + idx);
            if (!target) continue;
            var html = tpl.textContent || tpl.innerHTML || '';
            var m = html.match(/<img\b[\s\S]*?>/i);
            if (m && m[0]) {
                target.innerHTML = m[0];
            } else {
                // 若无图片，回退为原始文本的前 140 字符
                var text = html.replace(/<[^>]*>/g, '').trim();
                target.textContent = text.slice(0, 140);
            }
        }
    });
    </script>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./fedora-更新.html"
                       title="Fedora 42">
                        Fedora 42
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-0">
            </div>
            <script type="application/x-template" id="post-source-0"><p><img alt="image-20250802130104740" src="../../assets/image-20250802130104740.png"></p></script>
            <div class="meta">
<!-- includes/article_meta.html -->
              <a class="tag"  rel="tag" href="./tag-fedora.html">fedora</a><time class="tag" datetime="2025-08-02">2025-08-02</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./fedora-更新.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./ldme6.html"
                       title="LMDE 6 のインストールと設定">
                        LMDE 6 のインストールと設定
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-1">
            </div>
            <script type="application/x-template" id="post-source-1"><p><img alt="Screenshot from 2024-09-26 19-12-03" src="../../assets/Screenshot from 2024-09-26 19-12-03.png"></p>
<p>私は長い間 Linux Mint を使っています、その安定性と軽さが好きです。</p>
<p>しかし、最近21から22にアップグレードしたときに、それがクラッシュしました。
原因は、システムに多くの変更を加え、知らない第三者のリポジトリを使ったことだと推測しています。</p>
<p>それで、私はそれを再インストールしました、今回は Debian ベースの Linux Mint ディストリビューションである LMDE 6 を選びました。
なぜなら、頻繁に更新されたくなくて、安定した作業環境だけが欲しいからです。</p>
<p>LMDE 6 は他の Linux Mint ディストリビューションと同じように、btrfs、専用グラフィックドライバー、ハイバネーションなどの機能に対して、すぐに使える対応がされていますので、多くの設定時間を省けます。</p>
<p>ダウンロードアドレス：https://linuxmint.com/edition.php?id=308</p>
<h1>必要なソフトウェアのインストール</h1>
<p>できるだけ apt でのソフトウェアインストールを減らし、flatpak を使えるならできるだけそれを使用します。これにより、後の更新が簡単になり、システムのソースに影響を与えません。</p>
<div class="highlight"><pre><span></span><code>sudo apt install freerdp2-x11 fcitx-5 fcitx5-rime vim  sshpass sshfs unison linuxlogo xclip
sudo apt-get install grub2-theme-mint-2k    # grub の 4K での適応
sudo apt install fonts-noto-cjk fonts-wqy-zenhei fonts-wqy-microhei fonts-liberation
sudo fc-cache -fv
</code></pre></div>

<h1>システムに付属しているソフトウェアを削除する</h1>
<div class="highlight"><pre><span></span><code>sudo apt remove redshift-gtk
sudo apt-get remove --purge &#39;libreoffice*&#39;
sudo apt-get autoremove --purge &#39;libreoffice*&#39;
sudo apt remove thunderbird
sudo apt-get remove --auto-remove rhythmbox
</code></pre></div>

<h1>Flatpak 部分のソフトウェアインストールのソフトウェア</h1>
<div class="highlight"><pre><span></span><code>flatpak install -y flathub com.google.Chrome com.visualstudio.code com.microsoft.Edge org.keepassxc.KeePassXC com.qq.QQ com.tencent.WeChat org.libreoffice.LibreOffice com.spotify.Client org.mozilla.Thunderbird org.videolan.VLC com.wps.Office com.dropbox.Client org.freefilesync.FreeFileSync com.github.hluk.copyq org.filezillaproject.Filezilla io.github.cboxdoerfer.FSearch org.telegram.desktop org.freedesktop.Platform.Compat.i386 org.freedesktop.Platform.GL.default flathub org.gnome.FontManager org.gnome.font-viewer

flatpak install flathub org.winehq.Wine
flatpak override --user --filesystem=/home org.winehq.Wine
flatpak override --user --env=VARIABLE_NAME=value org.winehq.Wine
</code></pre></div></script>
            <div class="meta">
<!-- includes/article_meta.html -->
              <a class="tag"  rel="tag" href="./tag-debian.html">debian</a>              <a class="tag"  rel="tag" href="./tag-linux-mint.html">linux mint</a>              <a class="tag"  rel="tag" href="./tag-lmde.html">lmde</a><time class="tag" datetime="2024-09-26">2024-09-26</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./ldme6.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./kvm下vpn共享.html"
                       title="KVM下虚拟机的VPN网络共享">
                        KVM下虚拟机的VPN网络共享
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-2">
            </div>
            <script type="application/x-template" id="post-source-2"><p>之前折腾过VirtualBox下的虚拟机网络共享，其实KVM也支持，而且配置起来更加方便。</p>
<p>首先查看default网络：</p>
<p><img alt="image-20241128162143326" src="../../assets/image-20241128162143326.png"></p>
<p>在KVM虚拟机的网络设置里新增一个名为virbr1的隔离网络。</p>
<p>网关为：192.168.56.0/24</p>
<p>DHCP 不使用</p>
<p><img alt="image-20241126182554364" src="../../assets/image-20241126182554364.png"></p>
<p><img alt="image-20241126182507046" src="../../assets/image-20241126182507046.png"></p>
<p>把这个隔离网络添加给虚拟机：</p>
<p><img alt="image-20241128162346121" src="../../assets/image-20241128162346121.png"></p>
<p>然后虚拟机的仅共享网络指定对应IP：</p>
<p><img alt="image-20241126182921714" src="../../assets/image-20241126182921714.png"></p>
<p>最后把访问流量代理过去即可，为了方便使用，我写了以下脚本：</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># 参考https://blog.zenggyu.com/posts/zh/2022-05-04-%E5%9C%A8%E5%AE%BF%E4%B8%BB%E6%9C%BA%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84vpn%E8%BF%9E%E6%8E%A5/#fn2</span>

<span class="c1"># 定义DNS服务器列表</span>
<span class="nv">dns_servers</span><span class="o">=(</span>
<span class="w">    </span><span class="s2">&quot;180.76.76.76&quot;</span><span class="w">  </span><span class="c1"># 百度DNS</span>
<span class="w">    </span><span class="s2">&quot;223.5.5.5&quot;</span><span class="w">     </span><span class="c1"># 阿里云DNS</span>
<span class="w">    </span><span class="s2">&quot;119.29.29.29&quot;</span><span class="w">  </span><span class="c1"># 腾讯DNS</span>
<span class="o">)</span>

<span class="c1"># 定义IP地址列表</span>
<span class="nv">ip_addresses</span><span class="o">=(</span>
<span class="w">    </span><span class="s2">&quot;101.132.92.89/32&quot;</span>
<span class="o">)</span>
<span class="c1"># 将 DNS 服务器地址添加到 IP 地址列表</span>
<span class="k">for</span><span class="w"> </span>dns<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">dns_servers</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nv">ip_addresses</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$dns</span><span class="s2">/32&quot;</span><span class="o">)</span>
<span class="k">done</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;用法: </span><span class="nv">$0</span><span class="s2"> [d-删除全部路由规则]&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="c1"># 检查参数</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;d&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="c1"># 删除路由</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>ip<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ip_addresses</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span>sudo<span class="w"> </span>ip<span class="w"> </span>route<span class="w"> </span>del<span class="w"> </span><span class="nv">$ip</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;已删除路由: </span><span class="nv">$ip</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="c1"># 如果路由不存在，直接跳过，不输出错误信息</span>
<span class="w">            </span><span class="k">continue</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;❌ 所有存在的路由已删除。&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="c1"># 定义默认网关IP</span>
<span class="w">    </span><span class="nv">default_gateway</span><span class="o">=</span><span class="s2">&quot;192.168.56.2&quot;</span><span class="w">  </span><span class="c1"># 网关</span>

<span class="w">    </span><span class="c1"># 检查命令行参数是否提供了自定义网关IP</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$#</span><span class="s2">&quot;</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">default_gateway</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># 检查网络接口是否存在</span>
<span class="w">    </span><span class="nv">interface</span><span class="o">=</span><span class="k">$(</span>ip<span class="w"> </span>addr<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;inet 192.168.56.1/24 brd 192.168.56.255 scope global&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $NF}&#39;</span><span class="k">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$interface</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;错误：未找到匹配的网络接口&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;找到网络接口：</span><span class="nv">$interface</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># interface=&quot;host_only&quot;</span>

<span class="w">    </span><span class="c1"># 循环添加或更新路由规则</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>ip<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ip_addresses</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="nv">command</span><span class="o">=</span><span class="s2">&quot;sudo ip route replace </span><span class="nv">$ip</span><span class="s2"> via </span><span class="nv">$default_gateway</span><span class="s2"> dev </span><span class="nv">$interface</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$command</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">eval</span><span class="w"> </span><span class="nv">$command</span>
<span class="w">    </span><span class="k">done</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;✅ 所有路由已添加或更新。&quot;</span>

<span class="w">    </span><span class="c1"># 随机选择一个IP地址进行路由检查</span>
<span class="w">    </span><span class="nv">random_ip</span><span class="o">=</span><span class="si">${</span><span class="nv">ip_addresses</span><span class="p">[</span><span class="nv">$RANDOM</span><span class="p"> % </span><span class="si">${#</span><span class="nv">ip_addresses</span><span class="p">[@]</span><span class="si">}</span><span class="p">]</span><span class="si">}</span>
<span class="w">    </span><span class="nv">random_ip</span><span class="o">=</span><span class="si">${</span><span class="nv">random_ip</span><span class="p">%/*</span><span class="si">}</span><span class="w">  </span><span class="c1"># 移除CIDR表示法中的子网掩码部分</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;正在检查随机选择的IP地址路由: </span><span class="nv">$random_ip</span><span class="s2">&quot;</span>
<span class="w">    </span>ip<span class="w"> </span>route<span class="w"> </span>get<span class="w"> </span><span class="nv">$random_ip</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">    </span><span class="c1"># 随机选择一个DNS服务器</span>
<span class="w">    </span><span class="nv">random_dns</span><span class="o">=</span><span class="si">${</span><span class="nv">dns_servers</span><span class="p">[</span><span class="nv">$RANDOM</span><span class="p"> % </span><span class="si">${#</span><span class="nv">dns_servers</span><span class="p">[@]</span><span class="si">}</span><span class="p">]</span><span class="si">}</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;正在 ping 随机选择的 DNS 服务器: </span><span class="nv">$random_dns</span><span class="s2">...&quot;</span>
<span class="w">    </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="nv">$random_dns</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="k">fi</span>
</code></pre></div></script>
            <div class="meta">
<!-- includes/article_meta.html -->
              <a class="tag"  rel="tag" href="./tag-kvm.html">KVM</a>              <a class="tag"  rel="tag" href="./tag-vpn.html">VPN</a><time class="tag" datetime="2024-09-12">2024-09-12</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./kvm下vpn共享.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./win11-4k-taskbar.html"
                       title="Windows 11 でタスクバーを縮小する方法">
                        Windows 11 でタスクバーを縮小する方法
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-3">
            </div>
            <script type="application/x-template" id="post-source-3"><p><img alt="windows_11photo_2024-09-11_16-41-45" src="../../assets/windows_11photo_2024-09-11_16-41-45.jpg"></p>
<p>ある仕事のために、どうしても Windows を使わなければならず、外付けハードディスクを見つけて最新版の Windows 11 をインストールしました。インストール後、この大きなタスクバーが効率に大きく影響していることに気づきました。</p>
<p>解決策はたくさんありますが、私は <a href="https://windhawk.net/">windhawk</a> を選びました。パラメータはスクリーンショットを参照してください。4K の解像度でもうまく表示されます。</p></script>
            <div class="meta">
<!-- includes/article_meta.html -->
              <a class="tag"  rel="tag" href="./tag-windows.html">windows</a><time class="tag" datetime="2024-09-11">2024-09-11</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./win11-4k-taskbar.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./linux-win11-vpn.html"
                       title="Linux のホストマシンで仮想マシンの Windows の VPN 接続を使用する">
                        Linux のホストマシンで仮想マシンの Windows の VPN 接続を使用する
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-4">
            </div>
            <script type="application/x-template" id="post-source-4"><p><img alt="Screenshot from 2024-09-26 20-49-18" src="../../assets/Screenshot from 2024-09-26 20-49-18.png"></p>
<p>日本で中国のクライアントのサービスにアクセスするために、いろいろと比較した結果、最終的には<a href="https://x.com/iamcheyan/status/1822491047555142105">梯子を買いました</a>。</p>
<p>しかし、このVPNはWindowsのクライアントしか提供されておらず、Linuxで使うのはかなり手間がかかります。</p>
<p>この記事<a href="https://blog.zenggyu.com/posts/zh/2022-05-04-%E5%9C%A8%E5%AE%BF%E4%B8%BB%E6%9C%BA%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84vpn%E8%BF%9E%E6%8E%A5/#fn2">「ホストマシンで仮想マシンのVPN接続を使う方法」</a> に従って設定しました。</p>
<p>方法としては、まず仮想マシンに二つのネットワークカードを設定します。一つはNAT、もう一つはHost-Onlyです。Host-OnlyはVirtualBoxのネットワークマネージャーで事前に設定しておきます。</p>
<p>その後、ホストオンリーネットワークにVPN接続を共有し、仮想マシンのVPNをvboxnet0のイーサネット 2（192.168.56.2）インターフェースを通してホストマシンに共有します。</p>
<p>利便性を高めるために、次のスクリプトを書き、一連のアドレスを定義しました。実行前に仮想マシンをpingし、仮想マシンが起動していない場合はルーティングをクリアします。</p>
<p>もし仮想マシンが起動していれば、ルートを定義または更新します。</p>
<p>このように、仮想マシンがバックグラウンドで起動しているだけで、ホストマシンはシームレスにVPN経由で中国にアクセスできます。</p>
<p>注意：Windows 11仮想マシンでIPフォワーディングを有効にする必要があります</p>
<p>Windows 11が仮想マシンであるため、IPフォワーディングを有効にして、トラフィックが仮想マシンのVPNを通してホストマシンに転送されるようにする必要があります。</p>
<p>Win + Rを押し、regeditと入力してレジストリエディタを開きます。
以下のパスに移動します：</p>
<div class="highlight"><pre><span></span><code>HKEY_LOCAL_MACHINE<span class="se">\S</span>YSTEM<span class="se">\C</span>urrentControlSet<span class="se">\S</span>ervices<span class="se">\T</span>cpip<span class="se">\P</span>arameters
</code></pre></div>

<p><code>IPEnableRouter</code> キーを見つけます（存在しない場合は手動で作成）、その値を 1 に設定します。</p>
<p>変更を有効にするために、Windows 11 仮想マシンを再起動します。</p>
<p>Debian ホスト上で、以下のコマンドを実行し、すべての対象ネットワークが仮想マシンの 192.168.56.2 を経由してルーティングされるようにします：</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>ip<span class="w"> </span>route<span class="w"> </span>add<span class="w"> </span><span class="m">39</span>.99.177.215<span class="w"> </span>via<span class="w"> </span><span class="m">192</span>.168.56.2<span class="w"> </span>dev<span class="w"> </span>vboxnet0<span class="w">   </span><span class="c1"># 添加路由</span>
</code></pre></div>

<p>このように表示されれば、ルートが正常に追加されたことを示します。</p>
<div class="highlight"><pre><span></span><code>ip<span class="w"> </span>route<span class="w"> </span>get<span class="w"> </span><span class="m">39</span>.99.177.215<span class="w"> </span>
<span class="m">39</span>.99.177.215<span class="w"> </span>via<span class="w"> </span><span class="m">192</span>.168.56.2<span class="w"> </span>dev<span class="w"> </span>vboxnet0<span class="w"> </span>src<span class="w"> </span><span class="m">192</span>.168.56.1<span class="w"> </span>uid<span class="w"> </span><span class="m">1000</span><span class="w"> </span>
</code></pre></div></script>
            <div class="meta">
<!-- includes/article_meta.html -->
              <a class="tag"  rel="tag" href="./tag-vpn.html">VPN</a>              <a class="tag"  rel="tag" href="./tag-linux.html">Linux</a>              <a class="tag"  rel="tag" href="./tag-windows.html">Windows</a><time class="tag" datetime="2024-09-10">2024-09-10</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./linux-win11-vpn.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./vim.html"
                       title="簡単なモダンな VIM の設定">
                        簡単なモダンな VIM の設定
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-5">
            </div>
            <script type="application/x-template" id="post-source-5"><p><img alt="VIM" src="../../assets/VIM.jpg"></p>
<p><strong>最小限のパラメータで、VIM をモダンなエディタのように使える簡単な設定です。マウス操作ができ、一般的なショートカットキーでテキストを編集できます。</strong></p>
<div class="highlight"><pre><span></span><code><span class="s2">&quot; 基本设置</span>
<span class="s2">set nocompatible          &quot;</span><span class="w"> </span>使用vim而非vi
<span class="nb">set</span><span class="w"> </span>wildmenu<span class="w">              </span><span class="s2">&quot; 按TAB键时命令行自动补齐</span>
<span class="s2">set ignorecase smartcase  &quot;</span><span class="w"> </span>搜索时忽略大小写，但在有大写字母时匹配大小写
<span class="nb">set</span><span class="w"> </span>number<span class="w"> </span>relativenumber<span class="w"> </span><span class="s2">&quot; 显示相对行号和当前行号</span>
<span class="s2">set visualbell t_vb=      &quot;</span><span class="w"> </span>禁止响铃和闪烁
<span class="nb">set</span><span class="w"> </span>ruler<span class="w">                 </span><span class="s2">&quot; 显示当前光标位置</span>
<span class="s2">set autoread              &quot;</span><span class="w"> </span>文件在Vim之外修改过，自动重新读入
<span class="nb">set</span><span class="w"> </span>autowrite<span class="w">             </span><span class="s2">&quot; 设置自动保存内容</span>
<span class="s2">set autochdir             &quot;</span><span class="w"> </span>当前目录随着被编辑文件的改变而改变
<span class="nb">set</span><span class="w"> </span><span class="nv">mouse</span><span class="o">=</span>a<span class="w">               </span><span class="s2">&quot; 开启鼠标支持</span>
<span class="s2">set shiftwidth=4 tabstop=4 expandtab &quot;</span><span class="w"> </span>设置缩进为4个空格
<span class="nb">set</span><span class="w"> </span>smartindent<span class="w">           </span><span class="s2">&quot; 启用智能缩进</span>
<span class="s2">set autoindent            &quot;</span><span class="w"> </span>参考上一行的缩进方式进行自动缩进
<span class="nb">set</span><span class="w"> </span>smarttab<span class="w">              </span><span class="s2">&quot; 启用智能TAB键</span>
<span class="s2">set hlsearch incsearch    &quot;</span><span class="w"> </span>开启搜索结果的高亮显示和实时搜索
<span class="nb">set</span><span class="w"> </span>noswapfile<span class="w"> </span>nobackup<span class="w"> </span>nowritebackup<span class="w"> </span><span class="s2">&quot; 禁用交换文件和备份文件</span>

<span class="s2">&quot;</span><span class="w"> </span>设置backspace键功能
<span class="nb">set</span><span class="w"> </span><span class="nv">backspace</span><span class="o">=</span>eol,start,indent
<span class="s2">&quot; 设置backspace键在任何模式下都进入编辑模式并删除字符</span>
<span class="s2">nnoremap &lt;BS&gt; i&lt;BS&gt;</span>
<span class="s2">vnoremap &lt;BS&gt; i&lt;BS&gt;</span>

<span class="s2">&quot;</span><span class="w"> </span>tab设为4个空格
<span class="nb">set</span><span class="w"> </span><span class="nv">tabstop</span><span class="o">=</span><span class="m">4</span>
<span class="nb">set</span><span class="w"> </span><span class="nv">shiftwidth</span><span class="o">=</span><span class="m">4</span>
<span class="nb">set</span><span class="w"> </span><span class="nv">softtabstop</span><span class="o">=</span><span class="m">4</span>
<span class="nb">set</span><span class="w"> </span>expandtab
<span class="nb">set</span><span class="w"> </span>smarttab
<span class="s2">&quot; 新一行与上一行的缩进一致</span>
<span class="s2">set autoindent</span>

<span class="s2">&quot;</span><span class="w"> </span>性能优化
<span class="nb">set</span><span class="w"> </span>lazyredraw<span class="w">            </span><span class="s2">&quot; 提高宏执行速度</span>
<span class="s2">set ttyfast               &quot;</span><span class="w"> </span>加快终端连接速度

<span class="s2">&quot; 编码设置</span>
<span class="s2">set encoding=utf-8</span>
<span class="s2">set fileencoding=utf-8</span>
<span class="s2">set fileencodings=utf-8,gb2312,gb18030,gbk,ucs-bom,cp936,latin1</span>

<span class="s2">&quot;</span><span class="w"> </span>设置键绑定，使其与现代编辑器一致
<span class="s2">&quot; 撤销和重做</span>
<span class="s2">nnoremap &lt;silent&gt; &lt;C-z&gt; u</span>
<span class="s2">inoremap &lt;silent&gt; &lt;C-z&gt; &lt;C-o&gt;u</span>
<span class="s2">nnoremap &lt;silent&gt; &lt;C-y&gt; &lt;C-r&gt;</span>
<span class="s2">inoremap &lt;silent&gt; &lt;C-y&gt; &lt;C-o&gt;&lt;C-r&gt;</span>

<span class="s2">&quot;</span><span class="w"> </span>复制、剪切和粘贴
vnoremap<span class="w"> </span>&lt;silent&gt;<span class="w"> </span>&lt;C-c&gt;<span class="w"> </span><span class="s2">&quot;+y</span>
<span class="s2">vnoremap &lt;silent&gt; &lt;C-x&gt; &quot;</span>+d
nnoremap<span class="w"> </span>&lt;silent&gt;<span class="w"> </span>&lt;C-v&gt;<span class="w"> </span><span class="s2">&quot;+p</span>
<span class="s2">inoremap &lt;silent&gt; &lt;C-v&gt; &lt;C-r&gt;+</span>
<span class="s2">cnoremap &lt;silent&gt; &lt;C-v&gt; &lt;C-r&gt;+</span>

<span class="s2">&quot;</span><span class="w"> </span>强制退出（不保存）
nnoremap<span class="w"> </span>&lt;silent&gt;<span class="w"> </span>&lt;C-q&gt;<span class="w"> </span>:q!&lt;CR&gt;
inoremap<span class="w"> </span>&lt;silent&gt;<span class="w"> </span>&lt;C-q&gt;<span class="w"> </span>&lt;Esc&gt;:q!&lt;CR&gt;

<span class="s2">&quot; 全选</span>
<span class="s2">nnoremap &lt;silent&gt; &lt;C-a&gt; ggVG</span>
<span class="s2">inoremap &lt;silent&gt; &lt;C-a&gt; &lt;Esc&gt;ggVG</span>

<span class="s2">&quot;</span><span class="w"> </span>保存
nnoremap<span class="w"> </span>&lt;silent&gt;<span class="w"> </span>&lt;C-s&gt;<span class="w"> </span>:update&lt;CR&gt;
inoremap<span class="w"> </span>&lt;silent&gt;<span class="w"> </span>&lt;C-s&gt;<span class="w"> </span>&lt;Esc&gt;:update&lt;CR&gt;a

<span class="s2">&quot; 查找</span>
<span class="s2">nnoremap &lt;C-f&gt; /</span>
<span class="s2">inoremap &lt;C-f&gt; &lt;Esc&gt;/</span>

<span class="s2">&quot;</span><span class="w"> </span>在查找状态下切换搜索选项
cnoremap<span class="w"> </span>&lt;C-n&gt;<span class="w"> </span>&lt;C-g&gt;
cnoremap<span class="w"> </span>&lt;C-m&gt;<span class="w"> </span>&lt;C-t&gt;

<span class="s2">&quot; 全局替换</span>
<span class="s2">nnoremap &lt;C-h&gt; :%s///g&lt;Left&gt;&lt;Left&gt;&lt;Left&gt;</span>
<span class="s2">inoremap &lt;C-h&gt; &lt;Esc&gt;:%s///g&lt;Left&gt;&lt;Left&gt;&lt;Left&gt;</span>

<span class="s2">&quot;</span><span class="w"> </span>确保回车键在替换操作时可以正常工作
cnoremap<span class="w"> </span>&lt;expr&gt;<span class="w"> </span>&lt;CR&gt;<span class="w"> </span>getcmdtype<span class="o">()</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span><span class="s1">&#39;[/?]&#39;</span><span class="w"> </span>?<span class="w"> </span><span class="s1">&#39;&lt;CR&gt;&#39;</span><span class="w"> </span>:<span class="w"> </span><span class="s1">&#39;&lt;C-]&gt;&lt;CR&gt;&#39;</span>

<span class="s2">&quot; 窗口分割快捷键</span>
<span class="s2">nnoremap &lt;silent&gt; &lt;C-l&gt; :vsplit&lt;CR&gt;&lt;C-w&gt;l</span>
<span class="s2">nnoremap &lt;silent&gt; &lt;C-j&gt; :vsplit&lt;CR&gt;&lt;C-w&gt;h</span>
<span class="s2">nnoremap &lt;silent&gt; &lt;C-i&gt; :split&lt;CR&gt;&lt;C-w&gt;k</span>
<span class="s2">nnoremap &lt;silent&gt; &lt;C-k&gt; :split&lt;CR&gt;&lt;C-w&gt;j</span>

<span class="s2">&quot;</span><span class="w"> </span>显示行号
<span class="nb">set</span><span class="w"> </span>number
<span class="s2">&quot; 高亮显示当前行</span>
<span class="s2">set cursorline</span>
<span class="s2">&quot;</span><span class="w"> </span>让一行的内容不换行
<span class="nb">set</span><span class="w"> </span>nowrap
<span class="s2">&quot; 距窗口边缘还有多少行时滚动窗口</span>
<span class="s2">set scrolloff=8</span>

<span class="s2">&quot;</span><span class="w"> </span>显示不可见字符
<span class="nb">set</span><span class="w"> </span>list<span class="w"> </span><span class="nv">listchars</span><span class="o">=</span>tab:»·,trail:·,extends:&gt;,precedes:&lt;
<span class="s2">&quot; 在底部显示命令</span>
<span class="s2">set showcmd</span>
<span class="s2">&quot;</span><span class="w"> </span>允许在未保存的缓冲区间切换
<span class="nb">set</span><span class="w"> </span>hidden
<span class="s2">&quot; 设置分割窗口在下方和右侧打开</span>
<span class="s2">set splitbelow splitright</span>

<span class="s2">&quot;</span><span class="w"> </span>代码颜色主题
syntax<span class="w"> </span><span class="nb">enable</span><span class="w">              </span><span class="s2">&quot; 开启语法高亮并优化性能</span>
<span class="s2">if has(&#39;termguicolors&#39;)</span>
<span class="s2">    set termguicolors</span>
<span class="s2">endif</span>
<span class="s2">&quot;</span><span class="w"> </span>设置颜色主题
colorscheme<span class="w"> </span>evening
</code></pre></div></script>
            <div class="meta">
<!-- includes/article_meta.html -->
              <a class="tag"  rel="tag" href="./tag-vim.html">VIM</a><time class="tag" datetime="2024-08-10">2024-08-10</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./vim.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./fedora-hibernate.html"
                       title="Fedora 下 hibernate 休眠配置">
                        Fedora 下 hibernate 休眠配置
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-6">
            </div>
            <script type="application/x-template" id="post-source-6"><p>网上的方法都太复杂，其实Fedora本身就已经支持了休眠功能。</p>
<p>只要在安装的时候，为系统设置一个Swap分区，安装后系统会自动开启休眠。</p>
<p>在Fedora Linux 41.1.4 (Silverblue)中测试通过。</p>
<p><img alt="image-20241126182017497" src="../../assets/image-20241126182017497.png"></p></script>
            <div class="meta">
<!-- includes/article_meta.html -->
              <a class="tag"  rel="tag" href="./tag-fedora.html">fedora</a>              <a class="tag"  rel="tag" href="./tag-hibernate.html">hibernate</a><time class="tag" datetime="2024-04-26">2024-04-26</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./fedora-hibernate.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./20240318迁移btrfs分区.html"
                       title="BTRFS 分区迁移记录">
                        BTRFS 分区迁移记录
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-7">
            </div>
            <script type="application/x-template" id="post-source-7"><p>我的系统之前装在一个512G的硬盘里，随着使用空间逐渐变得捉禁见肘，正好手头有块空闲的1T硬盘，就打算迁移过去，以下步骤是在 ChatGPT 的帮助下完成的，我只是做个简单记录。</p>
<p>我使用的是 BTRFS（B-tree文件系统），它提供了高级快照、克隆和高效的数据存储等功能。当涉及到克隆BTRFS根文件系统时，传统工具如Clonezilla可能不适用，因为它们无法有效地传输UUID或范围（extents）。为了解决这个问题，BTRFS提供了自己的克隆工具，并且也有第三方工具可供使用。</p>
<p>BTRFS提供的一个常用克隆工具是<code>btrfs-replace</code>：</p>
<div class="highlight"><pre><span></span><code>btrfs replace start [-Bfr] &lt;srcdev&gt;|&lt;devid&gt; &lt;targetdev&gt; &lt;path&gt;
</code></pre></div>

<p>以下是我的源设备和目标设备的磁盘信息：</p>
<div class="highlight"><pre><span></span><code>源设备
设备                起点       末尾      扇区    大小 类型
/dev/nvme1n1p1      2048    2095797   2093750 1022.3M EFI 系统
/dev/nvme1n1p2 991825920 1000214527   8388608      4G Linux swap
/dev/nvme1n1p3   2097152  991825919 989728768  471.9G Linux 文件系统


目标设备
设备            起点       末尾       扇区   大小 类型
/dev/sdb1       2048    2099199    2097152     1G Linux 文件系统
/dev/sdb2    2099200  136316927  134217728    64G Linux swap
/dev/sdb3  136316928 2000408575 1864091648 888.9G Linux 文件系统
</code></pre></div>

<h4>克隆 EFI 分区</h4>
<p>首先，将源设备 <code>/dev/nvme1n1p1</code> 中的 EFI 分区内容克隆到目标设备 <code>/dev/sdb1</code> 上：</p>
<div class="highlight"><pre><span></span><code><span class="nv">sudo</span><span class="w"> </span><span class="nv">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">nvme1n1p1</span><span class="w"> </span><span class="nv">of</span><span class="o">=/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">sdb1</span><span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="mi">4</span><span class="nv">M</span>
</code></pre></div>

<h4>创建 Btrfs 文件系统</h4>
<p>如果目标设备的 <code>/dev/sdb3</code> 分区尚未格式化为 Btrfs 文件系统，请使用以下命令进行格式化：</p>
<div class="highlight"><pre><span></span><code>sudo mkfs.btrfs /dev/sdb3
</code></pre></div>

<h4>挂载目标设备</h4>
<p>创建一个临时目录作为挂载点，并将目标设备的 Btrfs 分区挂载到该目录：</p>
<div class="highlight"><pre><span></span><code>sudo mkdir /mnt/target
sudo mount /dev/sdb3 /mnt/target
</code></pre></div>

<h4>使用 <code>btrfs replace</code> 替换分区</h4>
<p>使用 <code>btrfs replace</code> 命令将源设备的 Btrfs 分区替换到目标设备的 Btrfs 分区上：</p>
<div class="highlight"><pre><span></span><code>sudo btrfs replace start -f /dev/nvme1n1p3 /dev/sdb3 /mnt/target
</code></pre></div>

<p>此命令将启动替换过程，并将源设备的 Btrfs 分区数据复制到目标设备的 Btrfs 分区中。</p>
<p>替换过程可能需要一段时间，具体时间取决于数据量的大小。</p>
<h4>等待替换完成</h4>
<p>等待替换过程完成。您可以使用 <code>btrfs replace status</code> 命令来查看替换进度：</p>
<div class="highlight"><pre><span></span><code>sudo btrfs replace status /mnt/target
</code></pre></div>

<h4>重启计算机</h4>
<p>重新启动计算机，并选择从新的 Btrfs 分区引导，这时会发现可以进入系统了，但新的 1T 盘却只有 512G 的磁盘空间，这时使用 Live CD 进入实时镜像，使用 GParted 检查一下这个新分区，它会自动修复磁盘空间。</p>
<p>修复完重启即可正常使用。</p></script>
            <div class="meta">
<!-- includes/article_meta.html -->
              <a class="tag"  rel="tag" href="./tag-btrfs-xi-tong-ke-long.html">Btrfs 系统克隆</a><time class="tag" datetime="2024-03-18">2024-03-18</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./20240318迁移btrfs分区.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./20240129北京联通固定ip.html"
                       title="北京联通固定IP通过光猫进行端口映射">
                        北京联通固定IP通过光猫进行端口映射
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-8">
            </div>
            <script type="application/x-template" id="post-source-8"><p>tags: 端口映射
cover_image_url: </p>
<hr>
<p><img alt="2024-01-28 16-49-06屏幕截图" src="../../assets/2024-01-28 16-49-06屏幕截图.jpg"></p>
<p>北京联通可以申请固定IP了，每月100，后付费，默认封<code>80</code>和 443`端口，但搭建些服务是没什么问题的。</p>
<p>它这个<code>FTTR</code>光猫默认也支持端口映射，可以把内网的端口映射出去，使用固定IP访问即可，方法如下：</p>
<blockquote>
<p>1.输入用户名和密码登录web界面，帐号密码在光猫后面；<br>
2.在<code>应用→高级NAT配置→IPv4虚拟主机配置</code>页面，点击新建；<br>
3.类型是<code>用户</code>，勾选<code>使能端口映射</code>，WAN名称一般是2_INTERNET_R_VID_3961(上网WAN)，协议一般选TCP/UDP；<br>
4.外部开始端口和外部结束端口是指网络侧设备访问的端口；<br>
5.内部开始端口和内部结束端口是指被访问内网设备的端口；<br>
6.内部主机是指被访问内网设备的IP地址；<br>
7.点击应用。</p>
</blockquote></script>
            <div class="meta">
<!-- includes/article_meta.html -->
<time class="tag" datetime="2024-01-29">2024-01-29</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./20240129北京联通固定ip.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./mint-切换窗口只显示当前显示器.html"
                       title="让 Linutx mint 使用 Alt-Tab 只显示当前窗口">
                        让 Linutx mint 使用 Alt-Tab 只显示当前窗口
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-9">
            </div>
            <script type="application/x-template" id="post-source-9"><p><img alt="image-20240103134809876" src="../../assets/image-20240103134809876.png"></p>
<h2>解释</h2>
<p>我有两个显示器，当使用<code>Alt-Tab</code>切换窗口时，无论当前在哪个显示器里，Mint 默认都会把两个显示器的内容都显示在 <code>Alt-Tab</code>中，很乱，在设置里也没这个选项，最后我在 <a href="https://github.com/linuxmint/cinnamon/issues/4330">这里</a> 找到了解决方案。</p>
<h3>方法</h3>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>xed<span class="w"> </span>/usr/share/cinnamon/js/ui/appSwitcher/appSwitcher.js<span class="w">   </span><span class="c1"># 修改切换窗口文件</span>
</code></pre></div>

<p>在大约65行左右的位置，找到<code>windows = windows.filter(Main.isInteresting);</code>这一行，在它的后面加一行<code>windows = windows.filter(w =&gt; w.get_monitor() === global.screen.get_current_monitor()) // 过滤当前显示器的窗口</code>，如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">function</span><span class="w"> </span><span class="n">getWindowsForBinding</span><span class="p">(</span><span class="n">binding</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Construct</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">windows</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">windows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="p">;</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">windowActors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">global</span><span class="p">.</span><span class="n">get_window_actors</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">let</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">windowActors</span><span class="p">)</span>
<span class="w">        </span><span class="n">windows</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">windowActors</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="n">get_meta_window</span><span class="p">());</span>

<span class="w">    </span><span class="n">windows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">windows</span><span class="p">.</span><span class="k">filter</span><span class="p">(</span><span class="n">Main</span><span class="p">.</span><span class="n">isInteresting</span><span class="p">);</span>
<span class="w">    </span><span class="n">windows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">windows</span><span class="p">.</span><span class="k">filter</span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">get_monitor</span><span class="p">()</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="k">global</span><span class="p">.</span><span class="n">screen</span><span class="p">.</span><span class="n">get_current_monitor</span><span class="p">())</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">过滤当前显示器的窗口</span>
</code></pre></div>

<p>然后<code>alt+f2</code>，输入<code>rt</code>重启 cinnamon 即可。</p>
<p>打算回头好好研究下这个文件，感觉通过 js+css 能完成许多好玩的系统自定义功能。</p>
<h1>进阶：修改切换窗口时显示缩略图的时间</h1>
<p><img alt="Peek 2024-01-03 14-06" src="../../assets/Peek 2024-01-03 14-06.gif"></p>
<p>顺便又研究了下，<code>/usr/share/cinnamon/js/ui/appSwitcher/classicSwitcher.js</code> 这里是有关切换任务时的另外一些设定，包含了这些参数：</p>
<div class="highlight"><pre><span></span><code><span class="n">POPUP_SCROLL_TIME</span><span class="o">:</span><span class="w"> </span><span class="err">弹出菜单滚动时间，单位为秒。它控制了弹出菜单中内容滚动的速度。</span>
<span class="n">POPUP_DELAY_TIMEOUT</span><span class="o">:</span><span class="w"> </span><span class="err">弹出延迟超时时间，单位为毫秒。它控制了弹出菜单的延迟时间，即鼠标悬停在应用图标上的一段时间后，才会触发弹出菜单。</span>
<span class="n">POPUP_FADE_OUT_TIME</span><span class="o">:</span><span class="w"> </span><span class="err">弹出菜单淡出时间，单位为秒。它控制了弹出菜单在隐藏时的淡出效果的持续时间。</span>
<span class="n">APP_ICON_HOVER_TIMEOUT</span><span class="o">:</span><span class="w"> </span><span class="err">应用图标悬停超时时间，单位为毫秒。它控制了鼠标在应用图标上悬停的时间，达到该时间后会触发相应的事件。</span>
<span class="n">THUMBNAIL_DEFAULT_SIZE</span><span class="o">:</span><span class="w"> </span><span class="err">缩略图默认大小，单位为像素。它定义了缩略图显示的默认大小。</span>
<span class="n">THUMBNAIL_POPUP_TIME</span><span class="o">:</span><span class="w"> </span><span class="err">缩略图弹出时间，单位为毫秒。它控制了缩略图显示的持续时间。</span>
<span class="n">THUMBNAIL_FADE_TIME</span><span class="o">:</span><span class="w"> </span><span class="err">缩略图淡出时间，单位为秒。它控制了缩略图在隐藏时的淡出效果的持续时间。</span>
<span class="n">PREVIEW_DELAY_TIMEOUT</span><span class="o">:</span><span class="w"> </span><span class="err">预览延迟超时时间，单位为毫秒。它控制了预览效果的延迟时间，即鼠标悬停在应用图标上的一段时间后，才会触发预览效果。</span>
<span class="n">PREVIEW_SWITCHER_FADEOUT_TIME</span><span class="o">:</span><span class="w"> </span><span class="err">预览切换器淡出时间，单位为秒。它控制了预览切换器在隐藏时的淡出效果的持续时间。</span>
<span class="n">iconSizes</span><span class="o">:</span><span class="w"> </span><span class="err">应用图标尺寸数组。它定义了不同大小的应用图标的尺寸，用于在切换器中显示不同大小的图标。</span>
</code></pre></div>

<p>把<code>THUMBNAIL_POPUP_TIME</code>改成<code>0</code>就可以让缩略图即时显示了。</p></script>
            <div class="meta">
<!-- includes/article_meta.html -->
              <a class="tag"  rel="tag" href="./tag-linutx-mint.html">Linutx mint</a><time class="tag" datetime="2024-01-03">2024-01-03</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./mint-切换窗口只显示当前显示器.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./使用grub2引导硬盘上的iso文件.html"
                       title="在 Btrfs 分区使用 Grub 硬盘引导 iso 镜像">
                        在 Btrfs 分区使用 Grub 硬盘引导 iso 镜像
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-10">
            </div>
            <script type="application/x-template" id="post-source-10"><p>tags: grub,  btrfs
cover_image_url: </p>
<hr>
<p><img alt="f556bdcd4b50800022394f89c49e254" src="../../assets/f556bdcd4b50800022394f89c49e254.jpg"></p>
<p>电脑上有一些 Linux 镜像，可以直接通过 Grub 启动，省去了往优盘拷贝的麻烦。</p>
<h2>代码</h2>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/grub.d/40_custom<span class="w">     </span><span class="c1"># 打开 grub 配置自定义文件</span>
</code></pre></div>

<p>然后添加以下内容：</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>
<span class="nb">exec</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span>+3<span class="w"> </span><span class="nv">$0</span>
<span class="c1"># This file provides an easy way to add custom menu entries.  Simply type the</span>
<span class="c1"># menu entries you want to add after this comment.  Be careful not to change</span>
<span class="c1"># the &#39;exec tail&#39; line above.</span>

menuentry<span class="w"> </span><span class="s2">&quot;Live CD&quot;</span><span class="w"> </span><span class="o">{</span>
<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nv">isofile</span><span class="o">=</span><span class="s2">&quot;/@home/cheyan/Documents/ISO/linuxmint-cinnamon-64bit-edge.iso&quot;</span>
<span class="w"> </span>loopback<span class="w"> </span>loop<span class="w"> </span><span class="o">(</span>hd0,gpt3<span class="o">)</span>/<span class="nv">$isofile</span>
<span class="w"> </span>linux<span class="w"> </span><span class="o">(</span>loop<span class="o">)</span>/casper/vmlinuz<span class="w"> </span><span class="nv">boot</span><span class="o">=</span>casper<span class="w"> </span>iso-scan/filename<span class="o">=</span><span class="nv">$isofile</span><span class="w"> </span>quiet<span class="w"> </span>noeject<span class="w"> </span>nopromt<span class="w"> </span>spalsh<span class="w"> </span>--
<span class="w"> </span>initrd<span class="w"> </span><span class="o">(</span>loop<span class="o">)</span>/casper/initrd.lz
<span class="o">}</span>
</code></pre></div>

<p>保存后执行：</p>
<div class="highlight"><pre><span></span><code>sudo update-grub    
sudo reboot
</code></pre></div>

<p>然后就能在启动菜单里通过<code>Live CD</code>选项启动镜像了。</p>
<h3>路径</h3>
<p>网上的方法都只是说了添加代码即可，但实际用的时候还是要因地制宜，根据自己的状况来修改。  </p>
<p>拿刚刚那个路径来说，<code>(hd0,gpt3)</code>里指的是在 Grub 下访问的编号，以及 Btrfs 分区的<code>home</code>在路径中是<code>@home</code>：</p>
<p><img alt="242f9af63ae78fdedd54f9351b2e177" src="../../assets/242f9af63ae78fdedd54f9351b2e177.jpg"></p>
<p>最简单的方法是开机的时候，在 Grub 界面中按<code>ESC</code>键，进入命令行中，使用<code>ls</code>命令，一个一个磁盘路径地试，直到找到真实路径为止。</p>
<h3>casper</h3>
<p><code>/casper/vmlinuz</code>和<code>/casper/initrd.lz</code>都是存储在ISO文件中的文件。</p>
<ul>
<li><code>/casper/vmlinuz</code> 是一个Linux内核映像文件，它是ISO文件中包含的实际内核文件。内核是操作系统的核心部分，负责管理系统资源、处理硬件和提供基本的系统功能。</li>
<li><code>/casper/initrd.lz</code> 是一个初始化 RAM 磁盘（initrd）映像文件，也被称为初始文件系统。它包含了启动过程中所需的一些文件和驱动程序。在引导过程中，内核首先加载 initrd 映像文件，然后根据其中的指令来加载必要的模块和文件系统。</li>
</ul>
<p>这两个文件不同的镜像，里面可能写的也不一样，需要自己打开镜像，看一下具体叫什么。</p>
<p><img alt="image-20231230011228951" src="../../assets/image-20231230011228951.png"></p></script>
            <div class="meta">
<!-- includes/article_meta.html -->
<time class="tag" datetime="2023-12-30">2023-12-30</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./使用grub2引导硬盘上的iso文件.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./解决休眠后自动重启的问题.html"
                       title="解决 Linux 休眠后自动重启的问题">
                        解决 Linux 休眠后自动重启的问题
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-11">
            </div>
            <script type="application/x-template" id="post-source-11"><p>tags: Linux,  hibernate
cover_image_url: </p>
<hr>
<p>最近机器不知道咋了，一休眠就会自动重启，明明看着已经休眠关机了，几秒钟后竟然又自己开了，非常耽误事。  </p>
<p>跟这个<a href="https://www.shuyz.com/posts/fix-linux-wakeup-right-after-suspend/">老哥的状况</a>几乎一模一样，解决方法也差不多，查看<code>/proc/acpi/wakeup</code>这个文件，它列出了系统中哪些设备可以唤醒计算机从睡眠状态中恢复。</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>/proc/acpi/wakeup<span class="w">   </span><span class="c1"># 查看系统电源管理状态</span>
</code></pre></div>

<p>以下是我的电源状态：</p>
<div class="highlight"><pre><span></span><code>Device  S-state   Status   Sysfs node
PEG1      S4    *disabled
PEGP      S4    *disabled
PEG2      S4    *disabled
PEGP      S4    *disabled
PEG3      S4    *disabled
PEGP      S4    *disabled
PEG0      S4    *enabled   pci:0000:00:06.0
PEGP      S4    *disabled  pci:0000:01:00.0
RP01      S4    *disabled
PXSX      S4    *disabled
RP02      S4    *disabled
PXSX      S4    *disabled
RP03      S4    *disabled
PXSX      S4    *disabled
RP04      S4    *disabled
PXSX      S4    *disabled
RP05      S4    *enabled   pci:0000:00:1c.0
PXSX      S4    *disabled  pci:0000:2d:00.0
RP06      S4    *disabled
PXSX      S4    *disabled
RP07      S4    *disabled
PXSX      S4    *disabled
RP08      S4    *disabled
PXSX      S4    *disabled
RP09      S4    *enabled   pci:0000:00:1d.0
PXSX      S4    *disabled  pci:0000:2e:00.0
PEGA      S4    *disabled
RP10      S4    *disabled
PXSX      S4    *disabled
RP11      S4    *disabled
PXSX      S4    *disabled
RP12      S4    *disabled
PXSX      S4    *disabled
RP13      S4    *disabled
PXSX      S4    *disabled
RP14      S4    *disabled
PXSX      S4    *disabled
RP15      S4    *disabled
PXSX      S4    *disabled
RP16      S4    *disabled
PXSX      S4    *disabled
RP17      S4    *disabled
PXSX      S4    *disabled
RP18      S4    *disabled
PXSX      S4    *disabled
RP19      S4    *disabled
PXSX      S4    *disabled
RP20      S4    *disabled
PXSX      S4    *disabled
RP21      S4    *disabled
PXSX      S4    *disabled
RP22      S4    *disabled
PXSX      S4    *disabled
RP23      S4    *disabled
PXSX      S4    *disabled
RP24      S4    *disabled
PXSX      S4    *disabled
XHCI      S4    *enabled   pci:0000:00:14.0
XDCI      S4    *disabled
HDAS      S4    *disabled  pci:0000:00:1f.3
CNVW      S4    *disabled  pci:0000:00:14.3
TXHC      S4    *enabled   pci:0000:00:0d.0
TDM0      S4    *enabled   pci:0000:00:0d.2
TDM1      S4    *disabled
TRP0      S4    *enabled   pci:0000:00:07.0
PXSX      S4    *disabled
TRP1      S4    *disabled
PXSX      S4    *disabled
TRP2      S4    *disabled
PXSX      S4    *disabled
TRP3      S4    *disabled
PXSX      S4    *disabled
AWAC      S4    *enabled   platform:ACPI000E:00
</code></pre></div>

<ul>
<li>第一列是设备名称。</li>
<li>第二列是设备的S状态，表示设备在系统的电源管理中处于何种状态。</li>
<li>第三列是设备的启用/禁用状态。</li>
<li>第四列是设备的Sysfs节点。</li>
</ul>
<p>其中，<code>S-state</code>的状态为<code>S4</code> 是 ACPI 中定义的系统休眠状态之一，也称为挂起到磁盘（Suspend-to-Disk）模式。在该模式下，计算机会将当前的内存状态保存到硬盘上并关闭所有设备，直到再次唤醒。</p>
<p>这也就是我使用的<code>hibernate</code>休眠。  </p>
<h3>禁用唤醒</h3>
<p>既然当前启用的全部都是有关<code>S4</code>的，那就索性全部关掉好了：</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;grep enabled /proc/acpi/wakeup | cut -f 1 -d &quot; &quot; | xargs -I {} sh -c &quot;echo {} &gt; /proc/acpi/wakeup&quot;&#39;</span><span class="w"> </span><span class="c1"># 禁用所有唤醒</span>
</code></pre></div>

<p>以上命令执行完后，再测试下休眠：</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>hibernate
</code></pre></div>

<p>会发现虽然正常了，但没过多久，以上设置就又会被改回来。</p>
<h3>脚本动作</h3>
<p><code>/usr/lib/systemd/system-sleep</code>这个目录可以创建自定义的脚本，在系统进入休眠或唤醒状态时执行特定的操作。</p>
<p>当系统进入休眠状态（suspend、hibernate 或 hybrid-sleep）之前，systemd 会按照字母顺序运行该目录中以 <code>.sh</code> 结尾的可执行文件。同样，在系统从休眠状态唤醒之后，systemd 也会运行这些脚本。</p>
<p>这些脚本可以执行一些必要的操作，例如保存和恢复设备状态、配置特定的设置等。</p>
<p>脚本接收两个参数：第一个参数表示操作类型（"pre" 表示休眠前操作，"post" 表示休眠后操作），第二个参数表示休眠状态（"suspend"、"hibernate" 或 "hybrid-sleep"）。</p>
<p>所以写一个自动化脚本：</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>nano<span class="w"> </span>/usr/lib/systemd/system-sleep/disable_automatic_wake-up
</code></pre></div>

<p>脚本内容：</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1"># /usr/lib/systemd/system-sleep</span>
<span class="k">case</span><span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="k">in</span>
<span class="w">    </span>pre<span class="o">)</span>
<span class="w">        </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;grep enabled /proc/acpi/wakeup | cut -f 1 -d &quot; &quot; | xargs -I {} sh -c &quot;echo {} &gt; /proc/acpi/wakeup&quot;&#39;</span><span class="w"> </span><span class="c1"># 禁用所有唤醒</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span>*<span class="o">)</span>
<span class="w">        </span><span class="p">;;</span>
<span class="k">esac</span>
</code></pre></div>

<p>每次在执行休眠之前，系统会先执行以上脚本，禁用掉所有唤醒动作，之后再休眠。</p>
<p>就不会再被唤醒了。</p></script>
            <div class="meta">
<!-- includes/article_meta.html -->
<time class="tag" datetime="2023-12-16">2023-12-16</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./解决休眠后自动重启的问题.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./mint-安装显卡驱动.html"
                       title="Linux Mint 安装 Nvidia 显卡驱动">
                        Linux Mint 安装 Nvidia 显卡驱动
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-12">
            </div>
            <script type="application/x-template" id="post-source-12"><p><img alt="5f4a764b546a3e3e5122a81143c27e2" src="../../assets/5f4a764b546a3e3e5122a81143c27e2.jpg"></p>
<p>Linux Mint 自带一个显卡驱动安装工具，但奇怪的是怎样都检测不出来我的 3050，只好手动安装了。</p>
<p>有两种方法，一种是使用<code>由 Canonical 成员维护的 NVIDIA 驱动程序 PPA</code>，一种是<code>利用 Nvidia CUDA 存储库</code>，流程都是添加源，然后从源里找驱动安装。</p>
<h2>NVIDIA 驱动程序 PPA</h2>
<h3>添加源</h3>
<p>现已正式发布，添加这个源就可以方便地下载驱动了：</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>add-apt-repository<span class="w"> </span>ppa:graphics-drivers/ppa<span class="w"> </span>-y
sudo<span class="w"> </span>apt<span class="w"> </span>update
</code></pre></div>

<h3>自动安装驱动</h3>
<div class="highlight"><pre><span></span><code>ubuntu-drivers<span class="w"> </span>devices<span class="w">  </span><span class="c1"># 检查 Nvidia 驱动程序安装状态</span>
sudo<span class="w"> </span>ubuntu-drivers<span class="w"> </span>autoinstall<span class="w"> </span><span class="c1"># 自动安装驱动</span>
</code></pre></div>

<h3>手动安装驱动</h3>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>nvidia-driver-535
</code></pre></div>

<h2>Nvidia CUDA 存储库</h2>
<h3>安装相关软件</h3>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>dirmngr<span class="w"> </span>ca-certificates<span class="w"> </span>software-properties-common<span class="w"> </span>apt-transport-https<span class="w"> </span>dkms<span class="w"> </span>curl<span class="w"> </span>-y
</code></pre></div>

<h3>导入密钥添加源</h3>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-fSsL<span class="w"> </span>https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/3bf863cc.pub<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/usr/share/keyrings/nvidia-drivers.gpg<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;deb [signed-by=/usr/share/keyrings/nvidia-drivers.gpg] https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/ /&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/nvidia-drivers.list
sudo<span class="w"> </span>apt<span class="w"> </span>update
</code></pre></div>

<h3>安装驱动</h3>
<div class="highlight"><pre><span></span><code>apt<span class="w"> </span>search<span class="w"> </span>nvidia-driver-*<span class="w">  </span><span class="c1"># 搜索</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>nvidia-driver-535<span class="w"> </span>cuda
</code></pre></div>

<h2>确认是否安装成功</h2>
<div class="highlight"><pre><span></span><code>nvidia-smi
nvidia-settings
</code></pre></div>

<h3>其他</h3>
<div class="highlight"><pre><span></span><code>nvidia-smi<span class="w"> </span>-pm<span class="w"> </span>ENABLED<span class="w"> </span><span class="c1"># 持久化</span>
</code></pre></div>

<p><a href="https://www.linuxcapable.com/install-nvidia-drivers-on-linux-mint/">参考链接</a></p></script>
            <div class="meta">
<!-- includes/article_meta.html -->
              <a class="tag"  rel="tag" href="./tag-ubuntu.html">ubuntu</a>              <a class="tag"  rel="tag" href="./tag-nvidia.html">Nvidia</a><time class="tag" datetime="2023-12-10">2023-12-10</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./mint-安装显卡驱动.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./linux-下-keepass-开启对-edge-的支持.html"
                       title="强制开启 Keepass 对 Edge 的浏览器密码支持">
                        强制开启 Keepass 对 Edge 的浏览器密码支持
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-13">
            </div>
            <script type="application/x-template" id="post-source-13"><p>tags: Keepass
cover_image_url: </p>
<hr>
<p>KeepassXC 忽然无法识别 Edge 浏览器了，表现是在<code>启用浏览器集成</code>内，<code>Edge</code>的选项是灰色的。</p>
<p>研究了下，虽然不知道如何把它启用，但可以通过自定义一个不用的浏览器，例如<code>Chromium</code> ，指定它使用Edge的位置即可。</p>
<p>我的配置位置在：<code>/home/cheyan/.config/microsoft-edge/NativeMessagingHosts/</code></p>
<p><img alt="image-20231201132650972" src="../../assets/image-20231201132650972.png"></p>
<p><img alt="image-20231201132828561" src="../../assets/image-20231201132828561.png"></p></script>
            <div class="meta">
<!-- includes/article_meta.html -->
<time class="tag" datetime="2023-12-01">2023-12-01</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./linux-下-keepass-开启对-edge-的支持.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./popos-tabby.html"
                       title="Pop!_OS 22.04 LTS 部署 Tabby">
                        Pop!_OS 22.04 LTS 部署 Tabby
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-14">
            </div>
            <script type="application/x-template" id="post-source-14"><p><img alt="Pop!_OS 22.04 LTS 部署 Tabby " src="../../assets/popOS%E4%B8%8B%E9%83%A8%E7%BD%B2Tabby.gif"></p>
<p>Tabby 是一个自托管的 AI 编码助手，为 GitHub Copilot 提供开源和本地替代方案。 
简单来说，就是一个可以部署在本地的 Copilot 服务。<br>
我的笔记本是英特尔QC7，它自带一块 NVIDIA GeForce GTX 1660 Ti 显卡，刚好可以用来进行本地运算。 </p>
<h2>安装依赖</h2>
<p>如果你也安装是集成 NVIDIA 的 popOS，那么默认便安装好了显卡驱动。<br>
之后只需要安装 CUDA 即可，这一部分 system76 的官网有 <a href="https://support.system76.com/articles/cuda/#not-running-pop_os">非常详细的教程</a>，这也是我喜欢这个发行版的原因，system76 这个公司是很认真地在做这个系统，并且要靠它赚钱。  </p>
<h2>拉取镜像</h2>
<p>前面依赖安装完成后，便可以拉取 Tabby 的 Docker 镜像了。<br>
使用 <a href="https://tabby.tabbyml.com/docs/installation/docker">Docker 启动 Tabby 有两种模式</a>，一种使用 CPU，一种使用 GPU。 
我这里选择 GPU :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--gpus<span class="w"> </span>all<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span>-v<span class="w"> </span><span class="nv">$HOME</span>/.tabby:/data<span class="w"> </span>tabbyml/tabby<span class="w"> </span>serve<span class="w"> </span>--model<span class="w"> </span>TabbyML/StarCoder-1B<span class="w"> </span>--device<span class="w"> </span>cuda
</code></pre></div>

<p>然后我得到了以下报错：</p>
<div class="highlight"><pre><span></span><code><span class="m">2023</span>-11-25T17:15:43.168198Z<span class="w">  </span>INFO<span class="w"> </span>tabby::serve:<span class="w"> </span>crates/tabby/src/serve/mod.rs:146:<span class="w"> </span>Starting<span class="w"> </span>server,<span class="w"> </span>this<span class="w"> </span>might<span class="w"> </span>takes<span class="w"> </span>a<span class="w"> </span>few<span class="w"> </span>minutes...
CUDA<span class="w"> </span>error<span class="w"> </span><span class="m">100</span><span class="w"> </span>at<span class="w"> </span>/root/workspace/crates/llama-cpp-bindings/llama.cpp/ggml-cuda.cu:478:<span class="w"> </span>no<span class="w"> </span>CUDA-capable<span class="w"> </span>device<span class="w"> </span>is<span class="w"> </span>detected
current<span class="w"> </span>device:<span class="w"> </span><span class="m">0</span>
</code></pre></div>

<p>这一步我搞了好久，百思不得其解。 <br>
最后在 gpt 的帮助下，我加上了<code>--privileged</code>参数，它可以赋予容器访问宿主机上所有设备的特权。<br>
通过这个参数可以让容器具有更高的权限，实现对 GPU 设备的访问。 <br>
所以启动命令如下：</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--privileged<span class="w"> </span>-it<span class="w"> </span>--gpus<span class="w"> </span>all<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span>-v<span class="w"> </span><span class="nv">$HOME</span>/.tabby:/data<span class="w"> </span>tabbyml/tabby<span class="w"> </span>serve<span class="w"> </span>--model<span class="w"> </span>TabbyML/StarCoder-1B<span class="w"> </span>--device<span class="w"> </span>cuda
</code></pre></div>

<p>得到如下反馈：
<img alt="Toddy" src="../../assets/popos_taddy.png"></p>
<p>这时打开 <a href="http://localhost:8080/">http://localhost:8080/</a> 就可以看到 Tabby 的后台了。</p>
<h2>集成 VS CODE</h2>
<p>在 vs code 的扩展里搜 Tabby，安装后右下角会显示 Tabby 的图标。<br>
每次写代码时，只用写注释即可，Tabby 会自动补全代码，并给出预览，如果觉得代码可用，按下<code>tab</code>键即可上屏。</p>
<h3>开机启动</h3>
<p>创建一个新的systemd服务单元文件。</p>
<p>使用以下命令创建一个名为<code>tabbyml.service</code>的文件：</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/systemd/system/tabbyml.service
</code></pre></div>

<p>在打开的文件中，输入以下内容：</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>TabbyML<span class="w"> </span>Docker<span class="w"> </span>Service
<span class="nv">Requires</span><span class="o">=</span>docker.service
<span class="nv">After</span><span class="o">=</span>docker.service

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Restart</span><span class="o">=</span>always
<span class="nv">ExecStart</span><span class="o">=</span>/usr/bin/docker<span class="w"> </span>run<span class="w"> </span>--privileged<span class="w"> </span>-it<span class="w"> </span>--gpus<span class="w"> </span>all<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span>-v<span class="w"> </span><span class="nv">$HOME</span>/.tabby:/data<span class="w"> </span>tabbyml/tabby<span class="w"> </span>serve<span class="w"> </span>--model<span class="w"> </span>TabbyML/StarCoder-1B<span class="w"> </span>--device<span class="w"> </span>cuda

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div>

<p>使用以下命令重新加载systemd服务配置：</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>tabbyml.service
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>tabbyml.service
</code></pre></div>

<h3>Tabby 配置参数</h3>
<div class="highlight"><pre><span></span><code><span class="err">##</span><span class="w"> </span><span class="n">Tabby代理配置文件</span>

<span class="err">##</span><span class="w"> </span><span class="n">在线文档</span><span class="err">：</span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">tabby</span><span class="p">.</span><span class="n">tabbyml</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">extensions</span><span class="o">/</span><span class="n">configuration</span>
<span class="err">##</span><span class="w"> </span><span class="n">您可以取消注释并编辑下面的值</span><span class="err">，</span><span class="n">以更改默认设置</span><span class="err">。</span>
<span class="err">##</span><span class="w"> </span><span class="n">此文件中的配置优先级低于IDE设置</span><span class="err">。</span>

<span class="err">##</span><span class="w"> </span><span class="n">服务器</span>
<span class="err">##</span><span class="w"> </span><span class="n">您可以在此处设置服务器端点和可选的身份验证令牌</span><span class="err">（</span><span class="n">如果需要</span><span class="err">）。</span>
<span class="err">#</span><span class="w"> </span><span class="o">[</span><span class="n">server</span><span class="o">]</span>
<span class="err">#</span><span class="w"> </span><span class="n">endpoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;http://localhost:8080&quot;</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">http或https</span><span class="w"> </span><span class="n">URL</span>
<span class="err">#</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;your-token-here&quot;</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">如果设置了令牌</span><span class="err">，</span><span class="n">请求头Authorization</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Bearer $token&quot;</span><span class="n">将自动添加</span>

<span class="err">##</span><span class="w"> </span><span class="n">您可以添加自定义请求头</span><span class="err">。</span>
<span class="err">#</span><span class="w"> </span><span class="o">[</span><span class="n">server.requestHeaders</span><span class="o">]</span>
<span class="err">#</span><span class="w"> </span><span class="n">Header1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Value1&quot;</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">在此处列出您的自定义标头</span>
<span class="err">#</span><span class="w"> </span><span class="n">Header2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Value2&quot;</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">值可以是字符串</span><span class="err">、</span><span class="n">数字或布尔值</span>

<span class="err">##</span><span class="w"> </span><span class="n">自动完成</span>
<span class="err">##</span><span class="w"> </span><span class="err">（</span><span class="n">自</span><span class="w"> </span><span class="mf">1.1.0</span><span class="w"> </span><span class="n">版起</span><span class="err">）</span><span class="n">您可以在此处设置自动完成请求的超时时间</span><span class="err">。</span>
<span class="err">##</span><span class="w"> </span><span class="n">请注意</span><span class="err">，</span><span class="n">服务器端也有一个超时配置</span><span class="err">。</span>
<span class="err">#</span><span class="w"> </span><span class="o">[</span><span class="n">completion</span><span class="o">]</span>
<span class="err">#</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4000</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="mi">4</span><span class="n">秒</span>

<span class="err">##</span><span class="w"> </span><span class="n">日志</span>
<span class="err">##</span><span class="w"> </span><span class="n">您可以在此处设置日志级别</span><span class="err">。</span><span class="n">日志文件位于</span><span class="o">~/</span><span class="p">.</span><span class="n">tabby</span><span class="o">-</span><span class="n">client</span><span class="o">/</span><span class="n">agent</span><span class="o">/</span><span class="n">logs</span><span class="o">/</span><span class="n">目录下</span><span class="err">。</span>
<span class="err">#</span><span class="w"> </span><span class="o">[</span><span class="n">logs</span><span class="o">]</span>
<span class="err">#</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;silent&quot;</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="ss">&quot;silent&quot;</span><span class="err">、</span><span class="ss">&quot;error&quot;</span><span class="n">或</span><span class="ss">&quot;debug&quot;</span>

<span class="err">##</span><span class="w"> </span><span class="n">匿名使用追踪</span>
<span class="err">##</span><span class="w"> </span><span class="n">Tabby会收集匿名使用数据并发送给Tabby团队</span><span class="err">，</span><span class="n">以帮助改进我们的产品</span><span class="err">。</span>
<span class="err">##</span><span class="w"> </span><span class="n">您的代码</span><span class="err">、</span><span class="n">生成的自动完成或任何敏感信息永远不会被跟踪或发送</span><span class="err">。</span>
<span class="err">##</span><span class="w"> </span><span class="n">有关数据收集的详细信息</span><span class="err">，</span><span class="nl">请参阅https</span><span class="p">:</span><span class="o">//</span><span class="n">tabby</span><span class="p">.</span><span class="n">tabbyml</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">extensions</span><span class="o">/</span><span class="n">configuration#usage</span><span class="o">-</span><span class="n">collection</span>
<span class="err">##</span><span class="w"> </span><span class="n">感谢您的贡献</span><span class="err">。</span><span class="n">但是</span><span class="err">，</span><span class="n">如果您不希望参与</span><span class="err">，</span><span class="n">请在此处禁用匿名使用追踪</span><span class="err">。</span>
<span class="err">#</span><span class="w"> </span><span class="o">[</span><span class="n">anonymousUsageTracking</span><span class="o">]</span>
<span class="err">#</span><span class="w"> </span><span class="n">disable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">设置为true以禁用</span>
</code></pre></div></script>
            <div class="meta">
<!-- includes/article_meta.html -->
              <a class="tag"  rel="tag" href="./tag-popos.html">popOS!</a>              <a class="tag"  rel="tag" href="./tag-tabby.html">Tabby</a>              <a class="tag"  rel="tag" href="./tag-gpt.html">GPT</a>              <a class="tag"  rel="tag" href="./tag-linux.html">Linux</a><time class="tag" datetime="2023-11-26">2023-11-26</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./popos-tabby.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./使用-dotsync-汇总和同步配置文件.html"
                       title="使用 Dotsync 汇总和同步配置文件">
                        使用 Dotsync 汇总和同步配置文件
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-15">
            </div>
            <script type="application/x-template" id="post-source-15"><p>Linux 下的软件和系统的配置文件常常散落在各处。<br>
比如 zsh 的配置文件存放在<code>~/.zshrc</code>，但 ssh 的配置却存放在<code>.ssh/config</code>，如何管理和同步它们是个很麻烦的事情。<br>
最近在 Github 上找到了 <a href="https://github.com/dotsync/dotsync">dotsync</a>，它是一个跨平台的配置文件管理工具。 <br>
它可以汇总本地的配置文件，使它们统一在某个目录下（通常是<code>~/.dotfiles</code>目录），然后使用软连接的方法指向原位置，这样当需要修改或者同步这些文件时，只需要在<code>~/.dotfiles</code>下修改即可。 </p>
<p><img alt="Dotsync" src="../../assets/dotsync.png"></p>
<h2>准备</h2>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>~/.dotfiles<span class="w">    </span><span class="c1"># 创建配置存储目录</span>
<span class="nb">cd</span><span class="w"> </span>~/.dotfiles<span class="w">  </span><span class="c1"># 切换到该目录</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/dotphiles/dotsync.git<span class="w">  </span><span class="c1"># 拉取程序</span>
</code></pre></div>

<p><code>~/.dotfiles</code>目录存放了dotsync的主程序，以及配置文件，比如 vim 配置，git 配置等等。<br>
将需要同步的文件都放在这里，需要注意的是，如果你的文件是在主目录下的隐藏文件，就要去掉文件名中的<code>.</code>，例如 .zshrc 文件需要更名为 zschrc。   </p>
<h2>配置</h2>
<div class="highlight"><pre><span></span><code>nano<span class="w"> </span>~/.dotfiles/dotsyncrc<span class="w">   </span><span class="c1"># 配置 dotsync</span>
</code></pre></div>

<p>打开 dotsync 的配置文件，以下是一个示例，它支持单个文件同步和子目录级别的同步，但写法是不一样的，注意，hostname 写自己主机的名字。  </p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>files<span class="o">]</span>
<span class="c1"># 在主目录下进行同步</span>
dotsyncrc
zshrc

<span class="c1"># 在子目录级别进行同步</span>
ssh/config:.ssh/config
oh-my-zsh/editorconfig:.oh-my-zsh/.editorconfig
<span class="o">[</span>endfiles<span class="o">]</span>

<span class="c1"># hostname </span>
<span class="o">[</span>hosts<span class="o">]</span>
pop-os<span class="w"> </span><span class="nv">git</span><span class="o">=</span>ANY
<span class="o">[</span>endhosts<span class="o">]</span>
</code></pre></div>

<h2>运行</h2>
<p>使用以下命令生成配置文件的软连接：</p>
<div class="highlight"><pre><span></span><code>~/.dotfiles/dotsync/bin/dotsync<span class="w"> </span>-L<span class="w"> </span>
</code></pre></div>

<p>运行后可以看到<code>~/.dotfiles/dotsyncrc</code>被软连接到了<code>~/.dotsyncrc</code>。 
以后修改的话，只要到<code>~/.dotfiles/</code>中进行编辑即可。</p>
<h3>以下是 dotsync 的命令解释：</h3>
<div class="highlight"><pre><span></span><code>-I：初始化一台机器，配置其使用 dotsync。
-L：将 dotfiles 符号链接到 $HOME 目录中。
-u：更新到最新的 dotfiles 版本，不包括子模块。
-U：更新到最新的 dotfiles 版本，包括子模块。
-P：将本地更改推送回仓库（仅适用于 git）。
-H host：在配置文件中指定的主机上执行操作，可以是“ALL”。
-a：对所有已知机器更新 dotfiles。
-A：对所有已知机器更新 dotfiles 和子模块。
-r：使用 rsync 代替 git 进行同步。
-f conf：使用指定的 dotsync 配置文件进行操作，默认为 &#39;~/.dotsyncrc&#39; 或 &#39;$DOTSYNCRC&#39;。
-d dotfiles：指定 dotfiles 目录的路径，默认为 &#39;~/.dotfiles&#39;。
-l：列出已配置的主机和 dotfiles。
-c：在所有已知机器上运行任意 shell 命令。
-g：类似于 -c，但仅在使用 git 的机器上运行。
-v：显示详细信息。
-h：显示帮助信息。
</code></pre></div></script>
            <div class="meta">
<!-- includes/article_meta.html -->
              <a class="tag"  rel="tag" href="./tag-dotsync.html">Dotsync</a>              <a class="tag"  rel="tag" href="./tag-linux.html">Linux</a><time class="tag" datetime="2023-11-26">2023-11-26</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./使用-dotsync-汇总和同步配置文件.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./配置子域名绑定ip端口.html"
                       title="Nginx 配置子域名绑定IP+端口">
                        Nginx 配置子域名绑定IP+端口
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-16">
            </div>
            <script type="application/x-template" id="post-source-16"><p>tags: Nginx, 宝塔, 运维
cover_image_url: </p>
<hr>
<p>主站架设在<code>10.0.5.248</code>，绑定了<code>iamcheyan.com</code>这个域名。<br>
随后，又在这个域名下面添加了几个子域名，每个域名对应一个端口。<br>
例如现在，要把<code>code.iamcheyan.com</code> 绑定到<code>10.0.5.248:3000</code>，使用 Nginx+宝塔 可以实现。</p>
<h2>域名解析</h2>
<p>先在域名运营商的域名解析中添加子域名，解析的IP跟主站点相同，这点不多讲了。</p>
<p>注意，不用在宝塔里添加对应域名的网站，这里直接修改Nginx配置文件实现绑定。</p>
<h2>宝塔检查 Nginx.conf</h2>
<p>打开宝塔，找到<code>nginx.conf</code>配置文件（/www/server/panel/vhost/nginx），打开它，可以看到在文件中有如下配置：</p>
<div class="highlight"><pre><span></span><code>include<span class="w"> </span>vhost/*.conf<span class="p">;</span><span class="w">   </span><span class="c1">#加载vhost目录下的虚拟主机配置文件</span>
</code></pre></div>

<p>这段配置的意思就是把当前目录下的 vhost 文件夹里的配置文件包含进来。<br>
如果你的没有，就照做写一下。</p>
<h2>添加子配置文件</h2>
<p>来到 vhost 目录下，可以看到里面已经有一个<code>iamcheyan.com.conf</code>的配置文件。<br>
把它复制一份为<code>code.iamcheyan.com.conf</code>，修改成如下内容：</p>
<div class="highlight"><pre><span></span><code>server
<span class="o">{</span>
<span class="w">    </span>listen<span class="w"> </span><span class="m">80</span><span class="p">;</span><span class="w">  </span><span class="c1"># 监听端口80</span>
<span class="w">    </span>server_name<span class="w"> </span>code.iamcheyan.com<span class="p">;</span><span class="w">  </span><span class="c1"># 定义服务器名称</span>

<span class="w">    </span>location<span class="w"> </span>/<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="c1"># 反向代理到服务器的端口3000</span>
<span class="w">        </span>proxy_pass<span class="w"> </span>http://10.0.5.248:3000/<span class="p">;</span>
<span class="w">        </span>proxy_set_header<span class="w"> </span>Host<span class="w"> </span><span class="nv">$host</span><span class="p">;</span><span class="w">  </span><span class="c1"># 设置请求头中的Host信息</span>
<span class="w">    </span><span class="o">}</span>

<span class="w">    </span>access_log<span class="w">  </span>C:/BtSoft/wwwlogs/code.iamcheyan.com.log<span class="p">;</span><span class="w">  </span><span class="c1"># 访问日志路径</span>
<span class="w">    </span>error_log<span class="w">  </span>C:/BtSoft/wwwlogs/code.iamcheyan.com.error.log<span class="p">;</span><span class="w">  </span><span class="c1"># 错误日志路径</span>
<span class="o">}</span>
</code></pre></div>

<p>之后重启 Nginx 服务。</p>
<h2>宝塔反向代理设置</h2>
<p>打开宝塔的反向代理设置，添加code.iamcheyan.com，url代理到http://127.0.0.1:3000，并绑定域名。</p>
<p>随后为绑定的域名申请SSL证书，即可打开SSL。</p></script>
            <div class="meta">
<!-- includes/article_meta.html -->
<time class="tag" datetime="2023-11-25">2023-11-25</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./配置子域名绑定ip端口.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./2023-11-23-在win下使用钩子.html"
                       title="在 Windows Server 使用 Git 钩子自动部署 pelican 静态页">
                        在 Windows Server 使用 Git 钩子自动部署 pelican 静态页
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-17">
            </div>
            <script type="application/x-template" id="post-source-17"><p><img alt="在 Windows Server 使用 Git 钩子自动部署 pelican 静态页" src="../assets/2023/2023-11-24 11-02-31屏幕截图.png"></p>
<!--more-->

<p>这个网站是托管在我使用 Gogs 搭建的私有 Git 上的。<br>
它包含了一个通过 pelican 运行的静态博客。<br>
写日志时，先从云端拉取最新代码，然后本地生成 html，再通过我写的一个 ftp 脚本更新到服务器里。<br>
但最近想到可以通过钩子把这个流程自动化。 
但因为我的主机是 Windows Server 2022，而网上的方法大多是针对 Linux 主机的，所以走了些弯路。<br>
最终 <a href="https://www.tygertec.com/git-hooks-practical-uses-windows/">看了这篇文章</a> 后才恍然大悟。 <br>
其实就是指定 hook 的解释器，以及对 Git 使用绝对路径。 </p>
<h2>钩子文本</h2>
<p>在 Gogs 的<code>仓库设置</code>页面的<code>管理 Git 钩子</code>里，编辑<code>post-receive</code> 钩子，告诉git在提交之后，调用 <code>hook.sh</code> 脚本：</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!C:/Program\ Files/Git/bin/bash.exe</span>
C:/Program<span class="se">\ </span>Files/Git/bin/bash.exe<span class="w"> </span><span class="s2">&quot;C:\wwwroot\iamcheyan.com\hook.sh&quot;</span>
</code></pre></div>

<h2>钩子内容</h2>
<p>前面的<code>钩子文本</code>调用了这里的 sh 脚本：C:\wwwroot\iamcheyan.com\hook.sh<br>
之所以要分开写，是因为在<code>post-receive</code> 钩子中无法直接使用<code>git push</code>，所以全写在了脚本中。</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!C:/Program\ Files/Git/bin/bash.exe</span>
<span class="c1"># C:\wwwroot\iamcheyan.com\hook.sh</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;钩子开始执行...&quot;</span>
<span class="nb">cd</span><span class="w"> </span>/c/wwwroot/iamcheyan.com<span class="w"> </span><span class="c1"># 切换到站点目录</span>
<span class="nb">unset</span><span class="w"> </span>GIT_DIR<span class="w">   </span><span class="c1"># 确保 Git 可以访问当前目录</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;正在拉取最新代码...&quot;</span>
C:/Program<span class="se">\ </span>Files/Git/bin/git.exe<span class="w"> </span>fetch<span class="w"> </span>--all<span class="w">   </span><span class="c1"># 获取最新的代码</span>
C:/Program<span class="se">\ </span>Files/Git/bin/git.exe<span class="w"> </span>reset<span class="w"> </span>--hard<span class="w"> </span>origin/master<span class="w">    </span><span class="c1"># 强制覆盖本地</span>
<span class="nb">cd</span><span class="w"> </span>/c/wwwroot/iamcheyan.com/app/pelican<span class="w"> </span><span class="c1"># 切换到 pelican</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;正在生成静态文件...&quot;</span>
pelican<span class="w"> </span>content<span class="w"> </span><span class="c1"># 渲染静态页</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;钩子执行完成&quot;</span>
</code></pre></div>

<p>设置以上钩子后，就可以在提交代码时，自动在服务器上拉取最新代码，并使用 pelican 渲染 html。<br>
这样只要一提交代码，再刷新网页，便可看到渲染好的博客文章了，十分方便。</p></script>
            <div class="meta">
<!-- includes/article_meta.html -->
              <a class="tag"  rel="tag" href="./tag-git.html">git</a>              <a class="tag"  rel="tag" href="./tag-gogs.html">gogs</a>              <a class="tag"  rel="tag" href="./tag-hook.html">hook</a><time class="tag" datetime="2023-11-23">2023-11-23</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./2023-11-23-在win下使用钩子.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./2023-11-20macbook强行升级.html"
                       title="OpenCore Legacy Patcher 强行升级 MacOS">
                        OpenCore Legacy Patcher 强行升级 MacOS
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-18">
            </div>
            <script type="application/x-template" id="post-source-18"><p><img alt="Alt text" src="../assets/2023/截屏0005-11-20 10.59.15.png"></p>
<!--more-->

<p>手头有一台2016年的 MacBook Pro A1708，也是最后一款可以换硬盘的 MacBook Pro，苹果已经停止了对它的支持，系统版本永远停在了 Monterey。</p>
<p>最近想使用最新版的 Safari，于是想到了强行升级，就找到了 OpenCore Legacy Patcher 这个工具，它其实就是把其它 Mac 电脑的型号信息写在 EFI 分区里，冒充新机器，骗过苹果以便得到更新。</p>
<p>网上的方法写得都太复杂了，又是下系统镜像，又是要刻录U盘，其实这个工具没那么麻烦。</p>
<p>下载 OpenCore Legacy Patcher 后，先点开<code>Settings</code>，把机器修成成一个特定的 Identifier。</p>
<p>具体型号清单见 <a href="https://dortania.github.io/OpenCore-Legacy-Patcher/MODELS.html">这个链接</a></p>
<p>我的是<code>MacBook Pro (13-inch, 2016, 2 Thunderbolt 3 ports)</code>，对应的 Identifier 是<code>MacBookPro13,1</code>，跟我的机型比较相似的是 <code>MacBook Pro (13-inch, 2019, 2 Thunderbolt 3 ports)</code>，对应的 Identifier 是<code>MacBookPro15,4</code>，那就选这个。</p>
<p>然后回到程序首页，点击<code>Builld and install OpenCore</code>，写入引导。
然后重启电脑，启动的时候按住 option 键，选择 OpenCore 的新引导，进入系统之后，点击系统更新，发现就可以查找到新的系统了。</p>
<p>但这时你会发现，系统卡卡的，显示器的分辨率也很大，也不能调整缩放，外接显示器也一无效，别急，安装完新系统之后，再次打开 OpenCore Legacy Patcher，然后点击<code>Post-unstall Root patch</code>，打入关键驱动，之后重启即可。</p>
<p>我的 2016 款使用正常，没什么明显问题。</p></script>
            <div class="meta">
<!-- includes/article_meta.html -->
              <a class="tag"  rel="tag" href="./tag-opencore.html">OpenCore</a><time class="tag" datetime="2023-11-20">2023-11-20</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./2023-11-20macbook强行升级.html">続きを読む</a>
            </div>
        </article>
        <article class="post">
            <header class="post-header">
                <h1>
                    <a rel="bookmark"
                       href="./20230901红米k50刷欧版教程.html"
                       title="红米K50刷欧版系统教程">
                        红米K50刷欧版系统教程
                    </a>
                </h1>

            </header>

            <div class="post-content js-first-image" id="post-content-19">
            </div>
            <script type="application/x-template" id="post-source-19"><p><img alt="红米K50刷欧版教程" src="../../assets/Screenshot_2023-11-21-12-57-08-171_com.android.settings.jpg"></p>
<p>红米K50是联发科的处理器，在小米国际版官网是没有global版的。 
但还好，有人做了 EU 版，<a href="https://mifirm.net/model/rubens.ttt#eu">Xiaomi Redmi K50 Firmware 下载</a>。  <br>
最新版本是<code>2022-12-29</code>发布的<code>V14.0.4.0.TLNCNXM Fastboot</code>。
注意，eu版不能用 MiFlash 来刷。
正确姿势是，先下载<a href="http://www.miui.com/unlock/index.html">小米手机解锁工具</a>，然后在Bootloader模式按住<code>音量下+开机按扭</code>，插 USB 连接到解锁工具。
然后把下载的固件解压缩，手机在 Bootloader 模式下，点击压缩包里的<code>*_fastboot_first_install_with_data_format.bat</code>
等命令行跑完即可。   <br>
我是在 Linux 下进行的，一切顺利。</p></script>
            <div class="meta">
<!-- includes/article_meta.html -->
              <a class="tag"  rel="tag" href="./tag-hong-mi.html">红米</a>              <a class="tag"  rel="tag" href="./tag-shua-ji.html">刷机</a><time class="tag" datetime="2023-09-01">2023-09-01</time>            </div>
            <div class="post-footer">
                <a class="readmore" href="./20230901红米k50刷欧版教程.html">続きを読む</a>
            </div>
        </article>
        <nav id="pagination">                <!-- <span id="first_page" class="a inactive">&#60;&#60;</span>
                     <span id="first_page" class="a inactive">&#60;</span> -->
                        <span class="a active">1</span>
                        <a href="./index2.html">2</a>
                        <a href="./index3.html">3</a>
                        <a href="./index4.html">4</a>
                        <a href="./index5.html">5</a>
                <a id="next_page" href="./index2.html">&#62;</a>
                <a id="last_page" href="./index21.html">&#62;&#62;</a>
</nav>            </section> <!-- /#page-main -->

            <aside id="page-side"><!-- begin includes/sidebar.html -->
<nav>
    <div class="site-search kit-hidden-tb">
        <form class="tipue_search_group" id="search" method="get" action="search.html?q=" role="search">
            <input type="text" name="q" id="tipue_search_input" pattern=".{2,}" list="search"
                   title="At least 2 characters">
            <button type="submit" class="tipue_search_button">
                <svg class="bi bi-search" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor"
                     xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                          d="M10.442 10.442a1 1 0 011.415 0l3.85 3.85a1 1 0 01-1.414 1.415l-3.85-3.85a1 1 0 010-1.415z"
                          clip-rule="evenodd"/>
                    <path fill-rule="evenodd"
                          d="M6.5 12a5.5 5.5 0 100-11 5.5 5.5 0 000 11zM13 6.5a6.5 6.5 0 11-13 0 6.5 6.5 0 0113 0z"
                          clip-rule="evenodd"/>
                </svg>
            </button>
            <datalist id="search">
                <option>sbxlm</option>
                <option>linux</option>
                <option>manjaro</option>
            </datalist>
        </form>
    </div>
</nav>
<nav>
    <h3>ページ</h3>
    <ul>
        <li><a href="./index.html">ホーム</a></li>
        <li><a href="./archives.html">アーカイブ</a></li>
    </ul>
</nav>
<nav>


<nav>
    <h3>友達の家</h3>
    <ul>
                <li><a href="http://www.imhan.com">寒泥</a></li>
                <li><a href="http://blog.dimpurr.com/">钉子の次元</a></li>
                <li><a href="https://plumz.me/">Plumz</a></li>
                <li><a href="https://lutaonan.com/">RandyBlog</a></li>
                <li><a href="https://dingyu.me/blog">丁宇 | DING Yu</a></li>
                <li><a href="https://mrzan.xyz">Mr.Zan</a></li>
                <li><a href="https://litterhougelangley.life/blog">HOUGE MADNESS BLOG</a></li>
                <li><a href="https://www.s31bz.com/">S31BZ</a></li>
    </ul>
</nav>
<h3>ランダム記事</h3>
<ul id="random-articles"></ul>
</nav>



<!-- end includes/sidebar.html --></aside> <!-- /#page-side -->
        </div> <!-- /#page-body -->

        <footer id="footer" role="contentinfo">
            <span>
                Powered by <a href="http://pelican.readthedocs.org" target="_blank">Pelican</a>
                &nbsp; /
                <a href="./archives.html">すべての記事</a>&nbsp; /
                <a href="./sitemap.xml" target="_blank">サイトマップ</a>
            </span>
            <span>
                © 2010 - <script>document.write(new Date().getFullYear());</script> &nbsp;
                <a href="http://iamcheyan.com/">Cheyan</a> All Rights Reserved &nbsp; /
                <a href="https://beian.miit.gov.cn/" target="_blank">京ICP备19045254号-1</a>
            </span>
        </footer>
    </div> <!-- /#page -->
    <link rel="stylesheet" type="text/css" href="./theme/css/highlightjs.css" />
    <script src="./theme/js/highlight.min.js"></script>
    <script src="./theme/js/darkmode-js.min.js"></script>
    <script>
        const options = {
            bottom: '32px',
            right: '32px',
            time: '0.5s',
            saveInCookies: true,
            label: '🌓',
            autoMatchOsTheme: true
        };
        const darkmode = new Darkmode(options);
        darkmode.showWidget();
    </script>
    <script src="./theme/js/commentTyping.js"></script>
</body>

</html>